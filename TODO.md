# MaiMNP Flutter应用开发任务清单

## 已完成
- [x] 创建项目基础结构（页面、服务、模型等）
- [x] 实现登录功能和用户状态管理
- [x] 创建基础页面（登录、主页、知识库、人设卡、消息、个人中心、关于）
- [x] 实现路由配置
- [x] 创建自定义文本输入框组件
- [x] 创建关于页面
- [x] 创建用户Star列表页面
- [x] 创建知识库详情页面
- [x] 创建人设卡详情页面
- [x] 更新API服务，添加新方法
- [x] 修复Persona模型类，添加缺失的属性
- [x] 修复PersonaDetailScreen中的类型错误
- [x] 修复PersonaScreen中的类型错误
- [x] 移除copyrightOwner相关代码
- [x] 修复message_screen.dart中的类型错误和语法问题
- [x] 修复所有Flutter分析器警告和错误（从13个减少到0个）
  - [x] 修复knowledge_screen.dart中的Response访问错误和类型问题
  - [x] 修复knowledge_detail_screen.dart中的模型属性缺失和构造函数参数错误
  - [x] 修复updatedAt为null时的日期格式化问题
  - [x] 修复super parameter语法问题
  - [x] 移除未使用的导入
  - [x] 修复弃用的withOpacity方法
  - [x] 修复analysis_options.yaml中的无效lint规则
- [x] 同步API文档到项目中，添加缺失的API方法
  - [x] 添加获取当前用户信息方法
  - [x] 添加上传知识库方法
  - [x] 添加上传人设卡方法
  - [x] 添加获取待审核知识库/人设卡方法
  - [x] 添加审核通过/拒绝方法
  - [x] 添加发送消息方法
- [x] 增强登录页面错误信息显示，便于调试
  - [x] 显示详细的错误提示
  - [x] 添加错误详情对话框
  - [x] 包含时间戳和可能的解决方案
  - [x] 显示HTTP错误码（如401、403、500等）
  - [x] 优化错误信息格式和可读性
  - [x] 修复NoSuchMethodError导致的null调用错误
  - [x] 增强AuthService的null检查和错误处理
  - [x] 根据错误类型提供具体的解决方案
  - [x] 修复前后端登录状态不一致问题（后端返回200但前端显示登录错误）
  - [x] 增强AuthService对多种字段名的兼容性支持（access_token/token、user/data、id/user_id等）
  - [x] 使登录错误详情弹窗文本可复制，便于调试
  - [x] 添加详细的响应调试信息，包括响应类型、headers、字段详情
  - [x] 增强对字符串响应的处理，支持纯文本成功消息检测
  - [x] 增强Dio配置，支持多种响应类型（JSON、纯文本）
  - [x] 添加响应类型自动检测和重试机制
  - [x] 改进HTTP请求头配置，明确指定接受的内容类型
- [x] 修复登录成功后页面跳转问题，成功导航到主页
- [x] 验证用户信息显示功能，ProfileTab正确显示用户名和角色
- [x] 修复UserProvider中的空值处理问题，消除"服务器返回了空值数据"错误
- [x] 创建ThemeProvider类，使用SharedPreferences持久化存储主题设置
- [x] 扩展AppTheme类，添加完整的暗色主题配置
- [x] 修改main.dart，集成ThemeProvider和暗色模式支持
- [x] 修改HomeScreen，将底部栏改为左侧边栏，添加主题切换按钮
- [x] 添加animations包支持页面切换动画效果

## 进行中
- [x] 实现主题和配色方案（橙色系）
- [x] 实现暗色模式及切换支持
- [x] 实现持久化存储暗色模式状态
- [x] 实现底部栏改为左侧边栏
- [x] 修复侧边栏收起时的重叠问题
- [x] 将logo替换为assets/logo/logo.png
- [x] 移除logo的衬底背景
- [x] 加速侧边栏动画并提升连贯性
- [x] 修复致命性错误（移除PageTransitionSwitcher的reverseDuration参数）
- [x] 优化侧边栏动画，文字延迟显示避免图标移位
- [x] 调整动画时长为250ms（侧边栏）+ 200ms（文字）+ 150ms（图标）+ 200ms（页面切换）
  - [x] 修复侧边栏收起时选中项宽度不匹配问题（优化收起状态padding和圆角）
  - [x] 优化动画时序避免控件挤压（分阶段：0-250ms侧边栏展开 → 100-250ms图标变化 → 200-400ms文字显示）
- [ ] 实现知识库相关功能（上传、浏览、Star）
- [ ] 实现人设卡相关功能（上传、浏览、Star）
- [ ] 实现审核功能（admin/moderator）
- [x] 实现消息/信箱功能（基础功能已完成，修复了类型错误）
- [ ] 实现后端服务地址切换功能

## 待完成
- [ ] 实现审核管理页面
- [ ] 实现服务器设置页面
- [ ] 实现公告功能（预留）
- [ ] 完善错误处理和加载状态
- [ ] 添加应用图标和启动画面
- [ ] 优化UI和用户体验
- [ ] 编写单元测试
- [ ] 准备发布配置

## 注意事项
1. 项目使用Provider进行状态管理
2. 使用Dio进行网络请求
3. 使用Material Design 3
4. 需要适配深色模式
5. 需要适配不同屏幕尺寸
6. 代码需要符合Flutter/Dart规范
7. 需要添加适当的错误处理和加载状态
8. API接口需要根据后端实际实现进行调整